<div class="audio-player" role="region" aria-label="–ê—É–¥–∏–æ–ø–ª–µ–µ—Ä">
  <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ—à–∏–±–∫–∏ -->
  @if (error()) {
    <div class="error-banner" role="alert" aria-live="assertive">
      <span class="error-icon">‚ö†Ô∏è</span>
      <span class="error-message">{{ error()?.message }}</span>
      <button 
        type="button" 
        class="error-close" 
        (click)="clearError()"
        aria-label="–ó–∞–∫—Ä—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ"
      >
        ‚úï
      </button>
    </div>
  }

  <div class="audio-left">
    <div class="cover-container">
      <img
        class="cover"
        [src]="track()?.cover || 'data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2260%22 height=%2260%22><rect width=%2260%22 height=%2260%22 fill=%23333/><text x=%2230%22 y=%2236%22 font-size=%2214%22 text-anchor=%22middle%22 fill=%22%23aaa%22>‚ô™</text></svg>'"
        [alt]="(track()?.title || '–¢—Ä–µ–∫') + ' ‚Äî –æ–±–ª–æ–∂–∫–∞'"
        loading="lazy"
        decoding="async"
      />
      @if (isLoading()) {
        <div class="loading-spinner" aria-label="–ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–∫–∞">
          <div class="spinner"></div>
        </div>
      }
    </div>
    <div class="audio-info">
      <div class="title" [attr.aria-label]="'–ù–∞–∑–≤–∞–Ω–∏–µ: ' + (track()?.title || '–ù–µ –≤—ã–±—Ä–∞–Ω–æ')">
        {{ track()?.title || '–ù–∏—á–µ–≥–æ –Ω–µ –∏–≥—Ä–∞–µ—Ç' }}
      </div>
      <div class="artist" [attr.aria-label]="'–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å: ' + (track()?.artist || '–ù–µ –≤—ã–±—Ä–∞–Ω')">
        {{ track()?.artist || '–í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–µ–∫' }}
      </div>
    </div>
  </div>

  <div class="audio-center">
    <div class="audio-controls">
      <button
        type="button"
        (click)="toggleShuffle()
        "
        [disabled]="!hasTrack()"
        [class.active]="isShuffle()"
        [attr.aria-pressed]="isShuffle()"
        aria-label="–ü–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ"
      >
        <span>üîÄ</span>
      </button>

      <button type="button" (click)="prev()" [disabled]="!hasTrack()" aria-label="–ü—Ä–µ–¥—ã–¥—É—â–∏–π —Ç—Ä–µ–∫">
        ‚èÆÔ∏è
      </button>

      <button
        type="button"
        class="play-pause"
        (click)="togglePlay()"
        [attr.aria-pressed]="isPlaying()"
        aria-label="–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ/–ø–∞—É–∑–∞"
      >
        @if (!isPlaying()) { <span>‚ñ∂Ô∏è</span> } @else { <span>‚è∏Ô∏è</span> }
      </button>

      <button type="button" (click)="next()" [disabled]="!hasTrack()" aria-label="–°–ª–µ–¥—É—é—â–∏–π —Ç—Ä–µ–∫">
        ‚è≠Ô∏è
      </button>

      <button
        type="button"
        (click)="toggleRepeat()"
        [disabled]="!hasTrack()"
        [class.active]="repeatMode() !== 'off'"
        [attr.aria-pressed]="repeatMode() !== 'off'"
        [attr.aria-label]="getRepeatTitle()"
        [title]="getRepeatTitle()"
      >
        <span [attr.aria-hidden]="true">{{ getRepeatIcon() }}</span>
      </button>
    </div>

    <div class="audio-progress">
      <span>{{ formatTime(currentTime()) }}</span>
      <input
        type="range"
        min="0"
        [attr.max]="duration() || 0"
        [value]="currentTime()"
        step="0.1"
        (input)="seek($event)"
        [disabled]="!hasTrack()"
        aria-label="–ü–æ–∑–∏—Ü–∏—è —Ç—Ä–µ–∫–∞"
      />
      <span>{{ formatTime(duration()) }}</span>
    </div>
  </div>

  <div class="audio-right">
    <div class="volume-control">
      <span aria-hidden="true">üîä</span>
      <input
        type="range"
        min="0"
        max="1"
        step="0.01"
        [value]="volume()"
        (input)="setVolume($event)"
        aria-label="–ì—Ä–æ–º–∫–æ—Å—Ç—å"
      />
    </div>
    
    <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–Ω—ã–º —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è–º -->
    <div class="keyboard-hints" role="tooltip" aria-label="–ö–ª–∞–≤–∏–∞—Ç—É—Ä–Ω—ã–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è">
      <details>
        <summary>‚å®Ô∏è</summary>
        <div class="hints-content">
          <div><kbd>Space</kbd> - –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ/–ø–∞—É–∑–∞</div>
          <div><kbd>‚Üê</kbd> - –ü—Ä–µ–¥—ã–¥—É—â–∏–π —Ç—Ä–µ–∫</div>
          <div><kbd>‚Üí</kbd> - –°–ª–µ–¥—É—é—â–∏–π —Ç—Ä–µ–∫</div>
          <div><kbd>M</kbd> - –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ</div>
          <div><kbd>R</kbd> - –†–µ–∂–∏–º –ø–æ–≤—Ç–æ—Ä–∞</div>
          <div><kbd>Esc</kbd> - –ó–∞–∫—Ä—ã—Ç—å –æ—à–∏–±–∫—É</div>
        </div>
      </details>
    </div>
  </div>
</div>
